<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenAI èŠå¤©é¢æ¿</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¤–</text></svg>">
    
    <!-- Tailwind CSSå’ŒdaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.9.4/dist/full.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- Highlight.js ç”¨äºä»£ç é«˜äº® -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    
    <!-- Marked.js ç”¨äºMarkdownè§£æ -->
    <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
    
    <!-- è‡ªå®šä¹‰CSS -->
    <link rel="stylesheet" href="css/main.css">
    
    <script>
        // Tailwindé…ç½®
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // ä¸»è‰²è°ƒ - æ›´ç°ä»£çš„è“ç»¿è‰²è°ƒ
                        'primary': '#0ea5e9',        // ä¸»è‰²
                        'primary-dark': '#0284c7',   // ä¸»è‰²æ·±è‰²ç‰ˆ
                        'primary-light': '#38bdf8',  // ä¸»è‰²æµ…è‰²ç‰ˆ
                        
                        // ç•Œé¢åŸºç¡€è‰²
                        'surface': '#ffffff',        // è¡¨é¢è‰²ï¼ˆä¸»è¦èƒŒæ™¯ï¼‰
                        'surface-hover': '#f1f5f9',  // è¡¨é¢è‰²æ‚¬åœçŠ¶æ€
                        'surface-active': '#e2e8f0', // è¡¨é¢è‰²æ¿€æ´»çŠ¶æ€
                        
                        // ç•Œé¢æ–‡å­—é¢œè‰²
                        'text-primary': '#0f172a',   // ä¸»è¦æ–‡å­—é¢œè‰²
                        'text-secondary': '#475569', // æ¬¡è¦æ–‡å­—é¢œè‰²
                        'text-muted': '#94a3b8',     // å¼±åŒ–æ–‡å­—é¢œè‰²
                        
                        // è¾¹æ¡†å’Œåˆ†å‰²çº¿
                        'border': '#e2e8f0',         // è¾¹æ¡†é¢œè‰²
                        'border-light': '#f1f5f9',   // æµ…è‰²è¾¹æ¡†

                        // åŠŸèƒ½è‰²
                        'success': '#10b981',        // æˆåŠŸè‰²
                        'warning': '#f59e0b',        // è­¦å‘Šè‰²
                        'error': '#ef4444',          // é”™è¯¯è‰²
                        'info': '#3b82f6',           // ä¿¡æ¯è‰²
                        
                        // å…¼å®¹æ—§ä»£ç çš„é¢œè‰²æ˜ å°„
                        'openai-sidebar': '#f8fafc',
                        'openai-hover': '#f1f5f9',
                        'openai-border': '#e2e8f0',
                        'openai-text': '#0f172a',
                        'openai-gray': '#64748b',
                        'openai-green': '#0ea5e9',
                        'openai-button': '#f8fafc',
                    }
                }
            },
            // ä½¿ç”¨CDNç‰ˆæœ¬çš„daisyUI
            daisyui: {
                themes: ["light", "dark"],
            },
        }
    </script>
</head>
<body class="bg-white text-openai-text flex h-screen">
    <!-- å·¦ä¾§è¾¹æ  - å¯¹è¯å†å² -->
    <aside class="w-64 bg-openai-sidebar border-r border-openai-border flex-shrink-0 flex flex-col h-full overflow-auto transition-all duration-300" id="sidebar">
        <!-- è¾¹æ å¤´éƒ¨ -->
        <div class="p-4 border-b border-openai-border">
            <button id="newChatBtn" class="bg-white text-openai-text hover:bg-openai-hover w-full py-2 px-3 rounded-md border border-openai-border flex items-center justify-between transition-all">
                <span class="font-medium">æ–°å»ºå¯¹è¯</span>
                <i class="fas fa-plus text-xs"></i>
            </button>
        </div>
        
        <!-- å¯¹è¯å†å²åˆ—è¡¨ -->
        <div class="flex-1 overflow-auto p-2">
            <div class="text-sm font-medium text-openai-gray uppercase tracking-wider px-2 mb-2">å¯¹è¯å†å²</div>
            <div id="conversationList" class="space-y-1">
                <!-- å¯¹è¯åˆ—è¡¨ç”±JSå¡«å…… -->
            </div>
        </div>
        
        <!-- è¾¹æ åº•éƒ¨ -->
        <div class="p-4 border-t border-openai-border">
            <div class="flex items-center">
                <div class="w-8 h-8 rounded-full bg-openai-green flex items-center justify-center text-white">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="ml-2">
                    <div class="text-sm font-medium">PureAI Panel</div>
                    <div class="text-xs text-openai-gray">v1.0.0</div>
                </div>
            </div>
        </div>
    </aside>
    
    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="flex-1 flex flex-col h-full overflow-hidden">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <header class="py-1 px-3 border-b border-openai-border flex items-center justify-between bg-white">
            <!-- æ¨¡å‹é€‰æ‹© -->
            <div id="modelDropdown" class="relative inline-block z-10">
                <button id="modelDropdownButton" class="bg-surface border border-border hover:bg-surface-hover dark:bg-gray-800 dark:border-gray-700 dark:hover:bg-gray-700 py-2 px-3 rounded-md text-sm flex items-center gap-2 cursor-pointer transition-colors">
                    <i class="fas fa-robot text-primary text-sm"></i>
                    <span id="selectedModel" class="text-text-primary dark:text-gray-200">åŠ è½½ä¸­...</span>
                    <i class="fas fa-chevron-down text-xs text-text-muted dark:text-gray-400"></i>
                </button>
                <div id="modelSelect" class="absolute left-0 top-full mt-1 bg-surface dark:bg-gray-800 shadow-lg rounded-md border border-border dark:border-gray-700 z-10 hidden">
                    <!-- è¿™é‡Œå°†ç”±ModelManager.jså¡«å……å†…å®¹ -->
                </div>
            </div>
            
            <!-- å³ä¾§å·¥å…·æ  -->
            <div class="flex items-center gap-3">
                <!-- ä½¿ç”¨å¸¦æœ‰æ›´å¥½è§†è§‰æ•ˆæœçš„æŒ‰é’® -->
                <button id="themeBtn" class="btn-action group" title="åˆ‡æ¢ä¸»é¢˜">
                    <div class="btn-action-content">
                        <i class="fas fa-moon text-sm group-hover:text-openai-green transition-colors"></i>
                    </div>
                </button>
                
                <button id="settingsBtn" class="btn-action group" title="APIè®¾ç½®">
                    <div class="btn-action-content">
                        <i class="fas fa-cog text-sm group-hover:text-openai-green transition-colors"></i>
                    </div>
                </button>
                
                <button id="clearChat" class="btn-action group" title="æ¸…é™¤å¯¹è¯">
                    <div class="btn-action-content">
                        <i class="fas fa-trash text-sm group-hover:text-openai-green transition-colors"></i>
                    </div>
                </button>
                
                <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
                <button id="mobileMenuBtn" class="btn-action group md:hidden" title="èœå•">
                    <div class="btn-action-content">
                        <i class="fas fa-bars text-sm group-hover:text-openai-green transition-colors"></i>
                    </div>
                </button>
            </div>
        </header>
        
        <!-- èŠå¤©åŒºåŸŸ -->
        <div class="flex-1 overflow-hidden flex flex-col bg-white">
            <!-- æ¶ˆæ¯åŒºåŸŸ -->
            <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-4"></div>
            
            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="p-4 border-t border-openai-border bg-white dark:bg-gray-800">
                <div class="max-w-3xl mx-auto">
                    <div class="relative rounded-lg border border-border shadow-sm focus-within:ring-1 focus-within:ring-primary focus-within:border-primary bg-surface dark:bg-gray-700">
                        <textarea 
                            id="messageInput" 
                            class="w-full p-3 pr-12 bg-transparent border-none focus:outline-none auto-resize max-h-[200px] text-text-primary dark:text-white"
                            placeholder="å‘é€æ¶ˆæ¯..."
                            rows="1"></textarea>
                        
                        <!-- å‘é€çŠ¶æ€æç¤ºï¼ˆç”Ÿæˆä¸­ï¼‰ -->
                        <div id="sendingIndicator" class="absolute right-3 bottom-3 h-6 w-6 flex items-center justify-center rounded-md text-text-muted dark:text-gray-400 hidden">
                            <i class="fas fa-spinner fa-spin text-sm"></i>
                        </div>
                        
                        <!-- åœæ­¢ç”ŸæˆæŒ‰é’® - åˆå§‹éšè— -->
                        <button id="stopButton" class="absolute right-3 bottom-3 h-6 w-6 flex items-center justify-center rounded-md hover:bg-surface-hover dark:hover:bg-gray-600 transition-all text-error hidden">
                            <i class="fas fa-stop text-sm"></i>
                        </button>
                        
                        <!-- å‘é€æŒ‰é’® -->
                        <button id="sendButton" class="absolute right-3 bottom-3 h-6 w-6 flex items-center justify-center rounded-md hover:bg-surface-hover dark:hover:bg-gray-600 transition-all text-primary disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-paper-plane text-sm"></i>
                        </button>
                    </div>
                    
                    <!-- åº•éƒ¨ä¿¡æ¯æ  -->
                    <div class="flex justify-between items-center mt-2">
                        <!-- AIåŠ©æ‰‹æç¤ºä¿¡æ¯ -->
                        <div class="text-xs text-text-muted dark:text-gray-400">
                            AI åŠ©æ‰‹ç”± OpenAI API æä¾›æ”¯æŒ
                        </div>
                        
                        <!-- åº•éƒ¨åŠŸèƒ½æŒ‰é’®ç»„ -->
                        <div class="flex items-center gap-2">
                            <button id="keyboardShortcutsBtn" class="text-xs px-2 py-1 rounded bg-surface-hover dark:bg-gray-700 text-text-secondary dark:text-gray-300 hover:bg-surface-active dark:hover:bg-gray-600 transition-colors flex items-center gap-1">
                                <i class="fas fa-keyboard text-xs"></i>
                                <span>å¿«æ·é”®</span>
                            </button>
                            <button id="apiSettingsBtn" class="text-xs px-2 py-1 rounded bg-surface-hover dark:bg-gray-700 text-text-secondary dark:text-gray-300 hover:bg-surface-active dark:hover:bg-gray-600 transition-colors flex items-center gap-1">
                                <i class="fas fa-info-circle text-xs"></i>
                                <span>API è®¾ç½®</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- æ¨¡å—åŒ–JSå¯¼å…¥ -->
    <script type="module">
        import { SettingsManager } from './js/settings.js';
        import { ApiClient } from './js/api.js';
        import { ChatUI } from './js/ui.js';
        import { ChatMessageComponent } from './components/ChatMessage.js';
        import { ConversationManager } from './js/conversation.js';
        import { Toast } from './components/Toast.js';
        import { HtmlPreview } from './components/HtmlPreview.js';
        import { ImageViewer } from './components/ImageViewer.js';
        
        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–ç»„ä»¶
            const settingsManager = new SettingsManager();
            const conversationManager = new ConversationManager();
            const apiClient = new ApiClient({
                settingsManager: settingsManager,
                conversationManager: conversationManager
            });
            
            // åˆå§‹åŒ–å…¨å±€Toast
            window.toast = new Toast();
            
            // åˆå§‹åŒ–HTMLé¢„è§ˆ
            window.htmlPreview = new HtmlPreview();
            
            // åˆå§‹åŒ–å›¾ç‰‡æŸ¥çœ‹å™¨
            window.imageViewer = new ImageViewer();
            
            // åˆå§‹åŒ–èŠå¤©UI
            const chatUI = new ChatUI({
                apiClient: apiClient,
                settingsManager: settingsManager,
                chatComponent: ChatMessageComponent,
                conversationManager: conversationManager
            });
            window.chatUI = chatUI;
            
            // æ£€æŸ¥å¿…è¦è®¾ç½®
            if (!settingsManager.hasRequiredSettings()) {
                // å¦‚æœæœªè®¾ç½®APIå¯†é’¥ï¼Œæ˜¾ç¤ºè®¾ç½®å¼¹çª—
                setTimeout(() => {
                    chatUI.openSettingsModal();
                }, 500);
            }
            
            // åˆå§‹åŒ–ä¸»é¢˜åˆ‡æ¢
            const themeBtn = document.getElementById('themeBtn');
            themeBtn.addEventListener('click', function() {
                const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                
                // æ›´æ–°ä¸»é¢˜
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('selected_theme', newTheme);
                
                // æ›´æ–°å›¾æ ‡
                const icon = themeBtn.querySelector('i');
                if (newTheme === 'dark') {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                }
                
                // æ˜¾ç¤ºä¸»é¢˜åˆ‡æ¢æç¤º
                window.toast.info(`å·²åˆ‡æ¢åˆ°${newTheme === 'dark' ? 'æš—è‰²' : 'äº®è‰²'}ä¸»é¢˜`);
            });
            
            // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
            const savedTheme = localStorage.getItem('selected_theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
                if (savedTheme === 'dark') {
                    const icon = themeBtn.querySelector('i');
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                }
            }
            
            // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const sidebar = document.getElementById('sidebar');
            
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('open');
            });
            
            // é…ç½®Marked.js
            marked.setOptions({
                highlight: function(code, lang) {
                    if (lang && hljs.getLanguage(lang)) {
                        return hljs.highlight(code, { language: lang }).value;
                    }
                    return hljs.highlightAuto(code).value;
                },
                breaks: true
            });
        });
    </script>
</body>
</html> 