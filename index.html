<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PureAIå¯¹è¯</title>
    
    <!-- ç™¾åº¦ç»Ÿè®¡ä»£ç  -->
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2b09e233276d57619d1ec3f1237e6a55";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¤–</text></svg>">
    
    <!-- Tailwind CSSå’ŒdaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.9.4/dist/full.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- Highlight.js ç”¨äºä»£ç é«˜äº® -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    
    <!-- Marked.js ç”¨äºMarkdownè§£æ -->
    <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
    
    <!-- è‡ªå®šä¹‰CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <script>
        // Tailwindé…ç½®
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // ä½¿ç”¨CSSå˜é‡æ¥å®šä¹‰é¢œè‰²ï¼Œä»¥æ”¯æŒä¸»é¢˜åˆ‡æ¢
                        'primary': 'var(--primary-color)',
                        'primary-dark': 'var(--primary-dark)',
                        'primary-light': 'var(--primary-light)',
                        
                        'background': 'var(--background-color)',
                        'secondary-bg': 'var(--secondary-bg)',
                        'tertiary-bg': 'var(--tertiary-bg)',
                        
                        'txt-primary': 'var(--text-primary)',
                        'txt-secondary': 'var(--text-secondary)',
                        'txt-tertiary': 'var(--text-tertiary)',
                        
                        'border-color': 'var(--border-color)',
                        'divider': 'var(--divider-color)',
                        
                        // å…¼å®¹æ—§ä»£ç çš„é¢œè‰²æ˜ å°„
                        'openai-sidebar': 'var(--secondary-bg)',
                        'openai-hover': 'var(--tertiary-bg)',
                        'openai-border': 'var(--border-color)',
                        'openai-text': 'var(--text-primary)',
                        'openai-gray': 'var(--text-secondary)',
                        'openai-green': 'var(--primary-color)',
                    }
                }
            },
            // å¯ç”¨æš—è‰²æ¨¡å¼
            darkMode: 'class',
            // ä½¿ç”¨CDNç‰ˆæœ¬çš„daisyUI
            daisyui: {
                themes: ["light", "dark"],
            },
        }
    </script>
</head>
<body class="bg-background text-txt-primary dark:bg-background flex h-screen">
    <!-- å·¦ä¾§è¾¹æ  - å¯¹è¯å†å² -->
    <aside class="w-64 bg-secondary-bg dark:bg-secondary-bg border-r border-border-color dark:border-border-color flex-shrink-0 flex flex-col h-full overflow-auto transition-all duration-300" id="sidebar">
        <!-- è¾¹æ å¤´éƒ¨ -->
        <div class="p-1 border-b border-border-color dark:border-border-color">
            <button id="newChatBtn" class="bg-background dark:bg-secondary-bg text-txt-primary dark:text-txt-primary hover:bg-tertiary-bg dark:hover:bg-tertiary-bg w-full py-2 px-3 rounded-md border border-border-color dark:border-border-color flex items-center justify-between transition-all">
                <span class="font-medium">æ–°å»ºå¯¹è¯</span>
                <i class="fas fa-plus text-xs"></i>
            </button>
        </div>
        
        <!-- å¯¹è¯å†å²åˆ—è¡¨ -->
        <div class="flex-1 overflow-auto p-2">
            <div class="text-sm font-medium text-txt-secondary dark:text-txt-secondary uppercase tracking-wider px-2 mb-2">å¯¹è¯å†å²</div>
            <div id="conversationList" class="space-y-1">
                <!-- å¯¹è¯åˆ—è¡¨ç”±JSå¡«å…… -->
            </div>
        </div>
        
        <!-- è¾¹æ åº•éƒ¨ -->
        <div class="p-4 border-t border-border-color dark:border-border-color">
            <div class="flex items-center">
                <div class="w-8 h-8 rounded-full bg-primary dark:bg-primary flex items-center justify-center text-white">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="ml-2">
                    <div class="text-sm font-medium text-txt-primary dark:text-txt-primary">PureAI Panel</div>
                    <div class="text-xs text-txt-secondary dark:text-txt-secondary">v1.0.2</div>
                </div>
            </div>
        </div>
    </aside>
    
    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="flex-1 flex flex-col h-full overflow-hidden bg-background dark:bg-background">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <header class="py-1 px-3 border-b border-border-color dark:border-border-color flex items-center justify-between bg-secondary-bg dark:bg-secondary-bg">
            <!-- æ¨¡å‹é€‰æ‹© -->
            <div id="modelDropdown" class="relative inline-block z-10">
                <button id="modelDropdownButton" class="bg-background dark:bg-secondary-bg border border-border-color dark:border-border-color hover:bg-tertiary-bg dark:hover:bg-tertiary-bg py-2 px-3 rounded-md text-sm flex items-center gap-2 cursor-pointer transition-colors min-w-[220px]">
                    <i class="fas fa-robot text-primary dark:text-primary text-sm"></i>
                    <span id="selectedModel" class="text-txt-primary dark:text-txt-primary">åŠ è½½ä¸­...</span>
                    <i class="fas fa-chevron-down text-xs text-txt-secondary dark:text-txt-secondary"></i>
                </button>
                <div id="modelSelect" class="absolute left-0 top-full mt-1 bg-background dark:bg-secondary-bg shadow-lg rounded-md border border-border-color dark:border-border-color z-10 hidden">
                    <!-- è¿™é‡Œå°†ç”±ModelManager.jså¡«å……å†…å®¹ -->
                </div>
            </div>
            
            <!-- å³ä¾§å·¥å…·æ  -->
            <div class="flex items-center gap-3">
                <!-- ä½¿ç”¨å¸¦æœ‰æ›´å¥½è§†è§‰æ•ˆæœçš„æŒ‰é’® -->
                <button id="announcementBtn" class="btn-action group" title="æŸ¥çœ‹å…¬å‘Š">
                    <div class="btn-action-content">
                        <i class="fas fa-bullhorn text-sm group-hover:text-primary dark:group-hover:text-primary transition-colors"></i>
                    </div>
                </button>
                
                <button id="themeBtn" class="btn-action group" title="åˆ‡æ¢ä¸»é¢˜">
                    <div class="btn-action-content">
                        <i class="fas fa-moon text-sm group-hover:text-primary dark:group-hover:text-primary transition-colors"></i>
                    </div>
                </button>
                
                <button id="settingsBtn" class="btn-action group" title="APIè®¾ç½®">
                    <div class="btn-action-content">
                        <i class="fas fa-cog text-sm group-hover:text-primary dark:group-hover:text-primary transition-colors"></i>
                    </div>
                </button>
                
                <button id="clearChat" class="btn-action group" title="æ¸…é™¤å¯¹è¯">
                    <div class="btn-action-content">
                        <i class="fas fa-trash text-sm group-hover:text-primary dark:group-hover:text-primary transition-colors"></i>
                    </div>
                </button>
                
                <a href="https://github.com/CooperJiang/PureAI-Panel" target="_blank" class="btn-action group" title="GitHubå¼€æºåœ°å€">
                    <div class="btn-action-content">
                        <i class="fab fa-github text-sm group-hover:text-primary dark:group-hover:text-primary transition-colors"></i>
                    </div>
                </a>
                
                <!-- ç§»åŠ¨ç«¯èœå•æŒ‰é’® -->
                <button id="mobileMenuBtn" class="btn-action group md:hidden" title="èœå•">
                    <div class="btn-action-content">
                        <i class="fas fa-bars text-sm group-hover:text-primary dark:group-hover:text-primary transition-colors"></i>
                    </div>
                </button>
            </div>
        </header>
        
        <!-- èŠå¤©åŒºåŸŸ -->
        <div class="flex-1 overflow-hidden flex flex-col bg-background dark:bg-background">
            <!-- æ¶ˆæ¯åŒºåŸŸ -->
            <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-4 overflow-x-hidden w-full bg-background dark:bg-background"></div>
            
            <!-- ä¸­æ–­ç”ŸæˆæŒ‰é’® - å›ºå®šåœ¨è¾“å…¥æ¡†ä¸Šæ–¹ -->
            <div id="interruptButtonContainer" class="hidden fixed left-1/2 transform -translate-x-1/2 bottom-32 z-50 animate-slideup">
                <button id="interruptButton" class="flex items-center gap-2 px-4 py-2 rounded-full bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors border border-red-200 dark:border-red-800 shadow-lg">
                    <i class="fas fa-stop text-sm"></i>
                    <span class="text-sm">ä¸­æ–­ç”Ÿæˆ</span>
                </button>
            </div>
            
            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="input-container">
                <div class="max-w-3xl mx-auto">
                    <div class="relative rounded-lg shadow-sm">
                        <textarea 
                            id="messageInput" 
                            class="input-textarea w-full pr-12 auto-resize max-h-[200px]"
                            placeholder="å‘é€æ¶ˆæ¯..."
                            rows="1"></textarea>
                        
                        <!-- å‘é€çŠ¶æ€æç¤ºï¼ˆç”Ÿæˆä¸­ï¼‰ -->
                        <div id="sendingIndicator" class="absolute hidden">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                        
                        <!-- å‘é€æŒ‰é’® -->
                        <button id="sendButton" class="send-button">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    
                    <!-- åº•éƒ¨ä¿¡æ¯æ  -->
                    <div class="flex justify-between items-center mt-2">
                        <!-- èµåŠ©å•†ä¿¡æ¯ -->
                        <div class="text-xs text-txt-secondary dark:text-txt-secondary flex gap-3 items-center">
                            <div class="flex items-center">
                                <i class="fas fa-robot text-primary dark:text-primary mr-1.5"></i>
                                <span>AIæœåŠ¡ç”±</span>
                                <a href="https://nineai.chat/chat" target="_blank" rel="noopener" class="text-primary dark:text-primary font-medium mx-1 hover:underline">NineAi</a>
                                <span>å…è´¹æä¾›</span>
                            </div>
                            <span>|</span>
                            <div class="flex items-center">
                                <i class="fas fa-image text-primary dark:text-primary mr-1.5"></i>
                                <span>å›¾ç‰‡å­˜å‚¨æœåŠ¡ç”±</span>
                                <a href="http://pixelpunk.cc/" target="_blank" rel="noopener" class="text-primary dark:text-primary font-medium mx-1 hover:underline">PixelPunk AIå›¾åºŠ</a>
                                <span>å…è´¹æä¾›</span>
                            </div>
                        </div>
                        
                        <!-- åº•éƒ¨åŠŸèƒ½æŒ‰é’®ç»„ -->
                        <div class="flex items-center gap-2">
                            <button id="contextToggleBtn" class="button-bottom" title="åˆ‡æ¢ä¸Šä¸‹æ–‡æ¨¡å¼">
                                <i class="fas fa-history text-xs mr-1"></i>
                                <span id="contextStatusText">ä¸Šä¸‹æ–‡å¼€å¯</span>
                            </button>
                            <button id="keyboardShortcutsBtn" class="button-bottom">
                                <i class="fas fa-keyboard text-xs mr-1"></i>
                                å¿«æ·é”®
                            </button>
                            <button id="apiSettingsBtn" class="button-bottom">
                                <i class="fas fa-gear text-xs mr-1"></i>
                                API è®¾ç½®
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- æ¨¡å—åŒ–JSå¯¼å…¥ -->
    <script type="module">
        import { SettingsManager } from './js/settings.js';
        import { ApiClient } from './js/api.js';
        import { ChatUI } from './js/ui.js';
        import { ChatMessageComponent } from './components/ChatMessage.js';
        import { ConversationManager } from './js/conversation.js';
        import { Toast } from './components/Toast.js';
        import { HtmlPreview } from './components/HtmlPreview.js';
        import { ImageViewer } from './components/ImageViewer.js';
        
        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–ç»„ä»¶
            const settingsManager = new SettingsManager();
            const conversationManager = new ConversationManager();
            const apiClient = new ApiClient({
                settingsManager: settingsManager,
                conversationManager: conversationManager
            });
            
            // åˆå§‹åŒ–å…¨å±€Toast
            window.toast = new Toast();
            
            // åˆå§‹åŒ–HTMLé¢„è§ˆ
            window.htmlPreview = new HtmlPreview();
            
            // åˆå§‹åŒ–å›¾ç‰‡æŸ¥çœ‹å™¨
            window.imageViewer = new ImageViewer();
            
            // åˆå§‹åŒ–èŠå¤©UI
            const chatUI = new ChatUI({
                apiClient: apiClient,
                settingsManager: settingsManager,
                chatComponent: ChatMessageComponent,
                conversationManager: conversationManager
            });
            window.chatUI = chatUI;
            
            // åˆå§‹åŒ–ä¸Šä¸‹æ–‡åˆ‡æ¢æŒ‰é’®
            const contextToggleBtn = document.getElementById('contextToggleBtn');
            const contextStatusText = document.getElementById('contextStatusText');
            if (contextToggleBtn && contextStatusText) {
                // åˆå§‹åŒ–æ˜¾ç¤ºå½“å‰çŠ¶æ€
                const isContextEnabled = settingsManager.get('contextEnabled', true);
                contextStatusText.textContent = isContextEnabled ? 'ä¸Šä¸‹æ–‡å¼€å¯ä¸­' : 'ä¸Šä¸‹æ–‡å…³é—­ä¸­';
                
                // åˆ‡æ¢äº‹ä»¶
                contextToggleBtn.addEventListener('click', () => {
                    const currentState = settingsManager.get('contextEnabled');
                    
                    // åˆ‡æ¢çŠ¶æ€ - æ˜ç¡®æŒ‡å®šå¸ƒå°”å€¼
                    const newState = !currentState;
                    settingsManager.set('contextEnabled', newState);
                    
                    // æ›´æ–°UI
                    contextStatusText.textContent = newState ? 'ä¸Šä¸‹æ–‡å¼€å¯ä¸­' : 'ä¸Šä¸‹æ–‡å…³é—­ä¸­';
                    
                    // å½“åˆ‡æ¢ä¸Šä¸‹æ–‡çŠ¶æ€æ—¶ï¼Œåœ¨å½“å‰ä½ç½®è®¾ç½®æ–­ç‚¹
                    if (conversationManager) {
                        if (newState) {
                            // å¼€å¯ä¸Šä¸‹æ–‡æ¨¡å¼æ—¶åªæ˜¾ç¤ºæç¤ºï¼Œä¸è®¾ç½®æ–­ç‚¹
                            window.toast.info('å·²å¼€å¯ä¸Šä¸‹æ–‡æ¨¡å¼ï¼Œä»å½“å‰ä½ç½®å¼€å§‹è®°å½•ä¸Šä¸‹æ–‡');
                        } else {
                            // å…³é—­ä¸Šä¸‹æ–‡æ¨¡å¼æ—¶è®¾ç½®æ–­ç‚¹
                            const breakpointSet = conversationManager.setContextBreakpoint();
                            
                            if (breakpointSet) {
                                window.toast.info('å·²å…³é—­ä¸Šä¸‹æ–‡æ¨¡å¼ï¼Œå¹¶åœ¨å½“å‰ä½ç½®è®¾ç½®æ–­ç‚¹');
                                
                                // ç«‹å³æ˜¾ç¤ºæ–°å¢çš„æ–­ç‚¹ - å³ä½¿åœ¨ç”ŸæˆçŠ¶æ€ä¹Ÿç›´æ¥æ’å…¥æ–­ç‚¹å…ƒç´ ï¼Œä¸é‡æ–°åŠ è½½æ•´ä¸ªå¯¹è¯
                                if (window.chatUI) {
                                    // è·å–æœ€æ–°è®¾ç½®çš„æ–­ç‚¹ä½ç½®
                                    const breakpoints = conversationManager.getBreakpoints();
                                    if (breakpoints.length > 0) {
                                        const latestBreakpoint = Math.max(...breakpoints);
                                        
                                        // è·å–èŠå¤©æ¶ˆæ¯å®¹å™¨
                                        const chatMessages = document.getElementById('chatMessages');
                                        if (chatMessages) {
                                            // åˆ›å»ºæ–­ç‚¹å…ƒç´ 
                                            const breakpointElement = window.chatUI.ChatMessageComponent.createContextBreakpoint(latestBreakpoint);
                                            
                                            // è·å–æ‰€æœ‰æ¶ˆæ¯å…ƒç´ 
                                            const messages = chatMessages.querySelectorAll('.chat');
                                            if (messages.length > 0) {
                                                // ä¿®æ­£: è®¡ç®—UIä¸­æ­£ç¡®çš„æ’å…¥ä½ç½®
                                                // è·å–æ¶ˆæ¯åˆ—è¡¨ä¸­å®é™…æ¶ˆæ¯æ•°é‡(ä¸åŒ…æ‹¬å·²æœ‰æ–­ç‚¹ç­‰éæ¶ˆæ¯å…ƒç´ )
                                                const messageElements = Array.from(messages).filter(el => !el.classList.contains('context-breakpoint'));
                                                
                                                // æ‰¾åˆ°æ­£ç¡®çš„æ’å…¥ä½ç½®ï¼Œç¡®ä¿æˆ‘ä»¬æ’å…¥åœ¨æ­£ç¡®ä½ç½®ä¹‹åçš„ç¬¬ä¸€æ¡æ¶ˆæ¯ä¹‹å‰
                                                // å¦‚æœlatestBreakpointæ°å¥½ç­‰äºæ¶ˆæ¯æ•°é‡ï¼Œåˆ™æ”¾åœ¨æœ€å
                                                if (latestBreakpoint >= messageElements.length) {
                                                    chatMessages.appendChild(breakpointElement);
                                                } else {
                                                    // æ‰¾åˆ°å¯¹åº”ä½ç½®çš„æ¶ˆæ¯å¹¶åœ¨å…¶å‰é¢æ’å…¥æ–­ç‚¹
                                                    const targetMessage = messageElements[latestBreakpoint];
                                                    if (targetMessage) {
                                                        chatMessages.insertBefore(breakpointElement, targetMessage);
                                                    } else {
                                                        // å¦‚æœæ‰¾ä¸åˆ°å¯¹åº”ä½ç½®ï¼ˆå¼‚å¸¸æƒ…å†µï¼‰ï¼Œåˆ™æ·»åŠ åˆ°æœ«å°¾
                                                        chatMessages.appendChild(breakpointElement);
                                                    }
                                                }
                                            } else {
                                                // å¦‚æœæ²¡æœ‰æ¶ˆæ¯ï¼Œåˆ™æ·»åŠ åˆ°æœ«å°¾
                                                chatMessages.appendChild(breakpointElement);
                                            }
                                            
                                            // ç»‘å®šæ–­ç‚¹åˆ é™¤äº‹ä»¶
                                            window.chatUI.bindBreakpointDeleteEvents();
                                        }
                                    }
                                }
                            } else {
                                window.toast.info('å·²å…³é—­ä¸Šä¸‹æ–‡æ¨¡å¼');
                            }
                        }
                    }
                });
            }
            
            // æ£€æŸ¥å¿…è¦è®¾ç½®
            // ç”±äºå·²æä¾›é»˜è®¤çš„ä»£ç†åœ°å€ï¼Œä¸å†éœ€è¦è‡ªåŠ¨å¼¹å‡ºè®¾ç½®å¼¹çª—
            // if (!settingsManager.hasRequiredSettings()) {
            //     // å¦‚æœæœªè®¾ç½®APIå¯†é’¥ï¼Œæ˜¾ç¤ºè®¾ç½®å¼¹çª—
            //     setTimeout(() => {
            //         chatUI.openSettingsModal();
            //     }, 500);
            // }
            
            // åˆå§‹åŒ–ä¸»é¢˜åˆ‡æ¢
            const themeBtn = document.getElementById('themeBtn');
            themeBtn.addEventListener('click', function() {
                const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                
                // æ›´æ–°ä¸»é¢˜
                document.documentElement.setAttribute('data-theme', newTheme);
                // æ›´æ–°Tailwindçš„æš—è‰²æ¨¡å¼ç±»
                if (newTheme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                localStorage.setItem('selected_theme', newTheme);
                
                // æ›´æ–°å›¾æ ‡
                const icon = themeBtn.querySelector('i');
                if (newTheme === 'dark') {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                }
                
                // æ˜¾ç¤ºä¸»é¢˜åˆ‡æ¢æç¤º
                window.toast.info(`å·²åˆ‡æ¢åˆ°${newTheme === 'dark' ? 'æš—è‰²' : 'äº®è‰²'}ä¸»é¢˜`);
            });
            
            // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
            const savedTheme = localStorage.getItem('selected_theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
                // æ·»åŠ æš—è‰²æ¨¡å¼ç±»ä»¥æ”¯æŒTailwindçš„dark: å‰ç¼€
                if (savedTheme === 'dark') {
                    document.documentElement.classList.add('dark');
                    const icon = themeBtn.querySelector('i');
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                }
            }
            
            // ç§»åŠ¨ç«¯èœå•åˆ‡æ¢
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const sidebar = document.getElementById('sidebar');
            
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.toggle('open');
            });
            
            // é…ç½®Marked.js
            marked.setOptions({
                highlight: function(code, lang) {
                    if (lang && hljs.getLanguage(lang)) {
                        return hljs.highlight(code, { language: lang }).value;
                    }
                    return hljs.highlightAuto(code).value;
                },
                breaks: true
            });
            
            // å…¬å‘Šå¼¹çª—ç®¡ç†
            const announcementModal = document.getElementById('announcementModal');
            const announcementBtn = document.getElementById('announcementBtn');
            const closeAnnouncementBtn = document.getElementById('closeAnnouncementBtn');
            const confirmAnnouncementBtn = document.getElementById('confirmAnnouncementBtn');
            const doNotShowAgain = document.getElementById('doNotShowAgain');
            
            // æ˜¾ç¤ºå…¬å‘Šå¼¹çª—
            function showAnnouncementModal() {
                if (announcementModal) {
                    // æ˜¾ç¤ºæ¨¡æ€æ¡†èƒŒæ™¯
                    announcementModal.classList.remove('hidden');
                    // å»¶è¿Ÿæ·»åŠ é€æ˜åº¦ï¼Œè§¦å‘è¿‡æ¸¡åŠ¨ç”»
                    setTimeout(() => {
                        announcementModal.classList.add('opacity-100');
                        // æ˜¾ç¤ºå†…å®¹å¹¶æ·»åŠ åŠ¨ç”»
                        const content = document.getElementById('announcementContent');
                        if (content) {
                            content.classList.remove('scale-95', 'opacity-0');
                            content.classList.add('scale-100', 'opacity-100');
                        }
                    }, 50);
                }
            }
            
            // éšè—å…¬å‘Šå¼¹çª—
            function hideAnnouncementModal() {
                if (announcementModal) {
                    // å…ˆéšè—å†…å®¹
                    const content = document.getElementById('announcementContent');
                    if (content) {
                        content.classList.remove('scale-100', 'opacity-100');
                        content.classList.add('scale-95', 'opacity-0');
                    }
                    
                    // å»¶è¿Ÿéšè—æ•´ä¸ªæ¨¡æ€æ¡†
                    announcementModal.classList.remove('opacity-100');
                    
                    // ç­‰å¾…åŠ¨ç”»å®Œæˆåéšè—æ•´ä¸ªæ¨¡æ€æ¡†
                    setTimeout(() => {
                        announcementModal.classList.add('hidden');
                    }, 300);
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦åœ¨7å¤©å†…ä¸å†æ˜¾ç¤ºå…¬å‘Š
            function shouldShowAnnouncement() {
                const lastShown = localStorage.getItem('announcement_last_shown');
                if (!lastShown) return true;
                
                const now = new Date().getTime();
                const daysDiff = (now - parseInt(lastShown)) / (1000 * 60 * 60 * 24);
                
                return daysDiff >= 7;
            }
            
            // è®¾ç½®æœ€åæ˜¾ç¤ºå…¬å‘Šçš„æ—¶é—´
            function setAnnouncementShown() {
                localStorage.setItem('announcement_last_shown', new Date().getTime().toString());
            }
            
            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            if (announcementBtn) {
                announcementBtn.addEventListener('click', showAnnouncementModal);
            }
            
            if (closeAnnouncementBtn) {
                closeAnnouncementBtn.addEventListener('click', hideAnnouncementModal);
            }
            
            if (confirmAnnouncementBtn) {
                confirmAnnouncementBtn.addEventListener('click', () => {
                    if (doNotShowAgain && doNotShowAgain.checked) {
                        setAnnouncementShown();
                    }
                    hideAnnouncementModal();
                });
            }
            
            // åˆæ¬¡è®¿é—®æˆ–è¶…è¿‡7å¤©è‡ªåŠ¨æ˜¾ç¤ºå…¬å‘Š
            if (shouldShowAnnouncement()) {
                // å»¶è¿Ÿæ˜¾ç¤ºï¼Œç¡®ä¿é¡µé¢å·²å®Œå…¨åŠ è½½
                setTimeout(showAnnouncementModal, 1000);
            }
        });
    </script>
    
    <!-- å…¬å‘Šå¼¹çª— -->
    <div id="announcementModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center hidden transition-opacity duration-300 opacity-0">
        <div id="announcementContent" class="bg-white dark:bg-secondary-bg rounded-lg shadow-xl max-w-lg w-full mx-4 transform transition-all duration-300 scale-95 opacity-0">
            <div class="p-5 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-medium text-gray-900 dark:text-white flex items-center">
                    <i class="fas fa-bullhorn text-primary dark:text-primary mr-2"></i>
                    ç³»ç»Ÿå…¬å‘Š
                </h3>
                <button id="closeAnnouncementBtn" class="text-gray-400 hover:text-gray-500 dark:text-gray-500 dark:hover:text-gray-400 transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-5 space-y-4 max-h-[70vh] overflow-y-auto">
                <div class="text-sm text-gray-700 dark:text-gray-300 space-y-3">
                    <p class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mr-2 mt-0.5"></i>
                        <span>æœ¬é¡¹ç›®ä¸º<strong class="text-primary dark:text-primary">çº¯å‰ç«¯é¡¹ç›®</strong>ï¼Œæˆ‘ä»¬ä¸ä¼šä¿ç•™æ‚¨çš„ä»»ä½•ä¿¡æ¯ï¼Œå®Œå…¨æœ¬åœ°åŒ–è¿è¡Œï¼Œä¿è¯å®‰å…¨å¯é ã€‚</span>
                    </p>
                    
                    <p class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mr-2 mt-0.5"></i>
                        <span>æœ¬ç½‘ç«™æ˜¯ OpenAI ç›´è¿çº¯å‡€ç‰ˆæœ¬ï¼Œé€Ÿåº¦å¿«ã€ä¸é™é¢ã€æ°¸ä¹…å…è´¹ä½¿ç”¨ã€‚</span>
                    </p>
                    
                    <p class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mr-2 mt-0.5"></i>
                        <span>å†…ç½®å¤šç§å…è´¹æ¨¡å‹ï¼Œæ— éœ€å¡«å†™ä»»ä½• API Keyï¼Œé›¶é…ç½®å³å¯ä½¿ç”¨ã€‚</span>
                    </p>
                    
                    <p class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mr-2 mt-0.5"></i>
                        <span>æ”¯æŒ OpenAI åè®®æ ¼å¼ï¼Œå¦‚éœ€ä½¿ç”¨å…¶ä»–æ¨¡å‹ï¼Œå¯åœ¨ API è®¾ç½®ä¸­ä½¿ç”¨è‡ªå·±çš„ä»£ç†åœ°å€ã€‚</span>
                    </p>

                    <p class="flex items-start">
                        <i class="fas fa-rocket text-blue-500 mr-2 mt-0.5"></i>
                        <span>æˆ‘ä»¬è‡´åŠ›äºæ‰“é€ <strong class="text-primary dark:text-primary">çº¯å‡€ã€å…è´¹ã€é«˜é€Ÿ</strong>çš„AIå·¥å…·ï¼Œä¸ºç”¨æˆ·æä¾›æœ€ä½³ä½¿ç”¨ä½“éªŒã€‚</span>
                    </p>
                    
                    <p class="flex items-start">
                        <i class="fas fa-comment text-blue-500 mr-2 mt-0.5"></i>
                        <span>å¦‚æœ‰ä½¿ç”¨ä½“éªŒåé¦ˆæˆ–ä¼˜åŒ–å»ºè®®ï¼Œæ¬¢è¿æ·»åŠ å¾®ä¿¡ï¼š<strong class="text-primary dark:text-primary">J_longyan</strong> è¿›è¡Œåé¦ˆï¼Œæ‚¨çš„æ„è§å¯¹æˆ‘ä»¬è‡³å…³é‡è¦ï¼</span>
                    </p>
                    
                    <div class="pt-2 border-t border-gray-200 dark:border-gray-700">
                        <p class="font-medium mb-2">ç‰¹åˆ«é¸£è°¢ï¼š</p>
                        <p class="flex items-start">
                            <i class="fas fa-robot text-primary dark:text-primary mr-2 mt-0.5"></i>
                            <span>API æœåŠ¡ç”± <a href="https://nineai.chat/chat" target="_blank" class="text-primary dark:text-primary hover:underline font-medium">NineAi</a> å…è´¹æä¾›</span>
                        </p>
                        <p class="flex items-start">
                            <i class="fas fa-image text-primary dark:text-primary mr-2 mt-0.5"></i>
                            <span>å›¾åºŠæœåŠ¡ç”± <a href="http://pixelpunk.cc/" target="_blank" class="text-primary dark:text-primary hover:underline font-medium">PixelPunk</a> å…è´¹æä¾›</span>
                        </p>
                    </div>
                    
                    <div class="pt-2 border-t border-gray-200 dark:border-gray-700">
                        <p class="flex items-start">
                            <i class="fab fa-github text-gray-700 dark:text-gray-300 mr-2 mt-0.5"></i>
                            <span>é¡¹ç›®å·²å¼€æºï¼Œè®¿é—® <a href="https://github.com/CooperJiang/PureAI-Panel" target="_blank" class="text-primary dark:text-primary hover:underline font-medium">GitHub ä»“åº“</a> è·å–æºç ã€‚</span>
                        </p>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between">
                <label class="flex items-center text-sm text-gray-600 dark:text-gray-400">
                    <input type="checkbox" id="doNotShowAgain" class="mr-2 accent-primary">
                    ä¸å†æç¤º
                </label>
                <button id="confirmAnnouncementBtn" class="px-3 py-1.5 text-sm bg-primary text-white rounded-md hover:bg-primary-dark transition-colors">
                    æˆ‘çŸ¥é“äº†
                </button>
            </div>
        </div>
    </div>
</body>
</html> 